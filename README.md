### rcms – ritmo CMS 2025 ###

### Структура проекта ###
├── assets/                  # Ресурсы
│   ├── css/
│   │   ├── critical.css     # Критические стили (встраиваются в HTML)
│   │   └── style.css        # Основные стили
│   └── js/
│       └── main.js          # Основной скрипт
│
├── blocks/                  # Блоки (компоненты)
│   ├── analytics.php        # Код аналитики (Google/Yandex)
│   ├── breadcrumbs.php      # Хлебные крошки
│   ├── content.php          # Блок контента (с проверкой safe_html)
│   ├── custom-block.php     # Кастомный блок (пример)
│   ├── footer.php           # Подвал (с кэш-меткой и аналитикой)
│   └── header.php           # Шапка (стили, заголовок)
│
├── pages/                   # Данные страниц
│   └── about/
│       └── data.json        # Контент для страницы "О компании"
│
├── templates/               # Шаблоны
│   ├── 404.php              # Страница 404
│   ├── error.php            # Общая страница ошибок
│   ├── home.php             # Шаблон главной
│   └── nested.php           # Шаблон вложенных страниц
│
├── cache/                   # Кэш HTML-страниц
├── index.php                # Точка входа (роутинг, рендеринг, кэш)
├── robots.txt               # Запрет индексации
└── site-config.json         # Конфиг (безопасность, аналитика, кэш)

### Логика работы ###
Запрос:
Пользователь запрашивает URL (например, /about).
index.php преобразует URL в путь к данным: /pages/about/data.json.

Загрузка данных:
Функция load_page_data() загружает data.json и наследует параметры от родительских страниц (если указан parent).
Данные фильтруются через allowed_blocks из site-config.json.

Рендеринг:
Для каждого блока (например, header, content) вызывается render_block(), который подключает соответствующий файл из blocks/.
Переменные ($page, $nonce, $config) передаются в шаблоны через extract().

Оптимизации:
Критические CSS/JS встраиваются прямо в HTML.
Кэширование: Готовый HTML сохраняется в cache/ с TTL 24 часа.

Безопасность:

CSP с nonce для скриптов.
Заголовки HSTS, X-Content-Type-Options и др.

Аналитика:
Блок analytics.php добавляет коды Google/Yandex Metrica, если они указаны в site-config.json.

### Ключевые особенности ###
Разделение данных и логики:
Контент управляется через JSON-файлы в pages/.
Шаблоны (templates/) и блоки (blocks/) не содержат бизнес-логики.

Производительность:
Кэширование снижает нагрузку на сервер.
Критические ресурсы встраиваются в HTML для ускорения первой загрузки.

Безопасность:
Динамический nonce для CSP предотвращает XSS.
Фильтрация блоков через конфиг (allowed_blocks).

Масштабируемость:
Легко добавлять новые страницы через JSON + шаблоны.
Поддержка наследования данных (например, общие настройки для раздела).
